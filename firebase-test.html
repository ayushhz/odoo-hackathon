<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Test - StackIt</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        .test-section {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border: 1px solid #333;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success { background: #10b981; }
        .error { background: #ef4444; }
        .warning { background: #f59e0b; }
        button {
            background: #646cff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background: #535bf2;
        }
        input {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            background: #333;
            border: 1px solid #555;
            color: white;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>üî• Firebase Setup Test</h1>
    
    <div class="test-section">
        <h2>üì° Firebase Connection Status</h2>
        <div id="connectionStatus" class="status warning">Testing Firebase connection...</div>
        <button onclick="testFirebaseConnection()">Test Connection</button>
    </div>

    <div class="test-section">
        <h2>üîê Authentication Test</h2>
        <div id="authStatus" class="status warning">Not tested yet</div>
        
        <h3>Test Registration:</h3>
        <input type="email" id="testEmail" placeholder="test@example.com" value="test@example.com">
        <input type="password" id="testPassword" placeholder="password123" value="password123">
        <input type="text" id="testUsername" placeholder="testuser" value="testuser">
        <br>
        <button onclick="testRegistration()">Test Register</button>
        <button onclick="testLogin()">Test Login</button>
        <button onclick="testLogout()">Test Logout</button>
    </div>

    <div class="test-section">
        <h2>üíæ Database Test</h2>
        <div id="dbStatus" class="status warning">Not tested yet</div>
        
        <h3>Test Question Creation:</h3>
        <input type="text" id="testQuestionTitle" placeholder="Test Question Title" value="How to test Firebase?">
        <textarea id="testQuestionContent" placeholder="Question content..." style="width:100%;height:60px;background:#333;color:white;border:1px solid #555;">This is a test question to verify Firebase is working correctly.</textarea>
        <br>
        <button onclick="testCreateQuestion()">Create Test Question</button>
        <button onclick="testLoadQuestions()">Load Questions</button>
    </div>

    <div class="test-section">
        <h2>üõ†Ô∏è Configuration Check</h2>
        <div id="configStatus" class="status warning">Checking configuration...</div>
        <button onclick="checkConfiguration()">Check Config</button>
        
        <h3>Quick Setup Instructions:</h3>
        <ol>
            <li>Go to <a href="https://console.firebase.google.com/" target="_blank">Firebase Console</a></li>
            <li>Create a new project</li>
            <li>Add a web app to your project</li>
            <li>Copy the config and paste it in firebase-config.js</li>
            <li>Enable Authentication (Email/Password)</li>
            <li>Create Firestore Database</li>
            <li>Come back and test!</li>
        </ol>
    </div>

    <!-- Firebase CDN Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-storage-compat.js"></script>
    
    <script>
        // Test Firebase Configuration
        const testFirebaseConfig = {
            apiKey: "your-api-key-here",
            authDomain: "your-project-id.firebaseapp.com",
            projectId: "your-project-id",
            storageBucket: "your-project-id.appspot.com",
            messagingSenderId: "your-sender-id",
            appId: "your-app-id"
        };

        let app, auth, db;

        function updateStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `status ${type}`;
        }

        function testFirebaseConnection() {
            updateStatus('connectionStatus', 'Testing...', 'warning');
            
            try {
                // Check if Firebase is loaded
                if (typeof firebase === 'undefined') {
                    updateStatus('connectionStatus', '‚ùå Firebase not loaded from CDN', 'error');
                    return;
                }

                // Check if config is updated
                if (testFirebaseConfig.apiKey === "your-api-key-here") {
                    updateStatus('connectionStatus', '‚ö†Ô∏è Firebase config not updated yet', 'warning');
                    return;
                }

                // Try to initialize Firebase
                app = firebase.initializeApp(testFirebaseConfig);
                auth = firebase.auth();
                db = firebase.firestore();
                
                updateStatus('connectionStatus', '‚úÖ Firebase connected successfully!', 'success');
                
            } catch (error) {
                updateStatus('connectionStatus', `‚ùå Connection failed: ${error.message}`, 'error');
            }
        }

        async function testRegistration() {
            if (!auth) {
                updateStatus('authStatus', '‚ùå Firebase not initialized', 'error');
                return;
            }

            const email = document.getElementById('testEmail').value;
            const password = document.getElementById('testPassword').value;
            const username = document.getElementById('testUsername').value;

            try {
                updateStatus('authStatus', 'Creating account...', 'warning');
                
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                // Store user data in Firestore
                await db.collection('users').doc(user.uid).set({
                    uid: user.uid,
                    email: email,
                    username: username,
                    displayName: username,
                    reputation: 0,
                    joinDate: firebase.firestore.FieldValue.serverTimestamp(),
                    role: 'user'
                });
                
                updateStatus('authStatus', `‚úÖ Account created successfully! UID: ${user.uid}`, 'success');
                
            } catch (error) {
                updateStatus('authStatus', `‚ùå Registration failed: ${error.message}`, 'error');
            }
        }

        async function testLogin() {
            if (!auth) {
                updateStatus('authStatus', '‚ùå Firebase not initialized', 'error');
                return;
            }

            const email = document.getElementById('testEmail').value;
            const password = document.getElementById('testPassword').value;

            try {
                updateStatus('authStatus', 'Signing in...', 'warning');
                
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                updateStatus('authStatus', `‚úÖ Login successful! Welcome ${user.email}`, 'success');
                
            } catch (error) {
                updateStatus('authStatus', `‚ùå Login failed: ${error.message}`, 'error');
            }
        }

        async function testLogout() {
            if (!auth) {
                updateStatus('authStatus', '‚ùå Firebase not initialized', 'error');
                return;
            }

            try {
                await auth.signOut();
                updateStatus('authStatus', '‚úÖ Logged out successfully!', 'success');
            } catch (error) {
                updateStatus('authStatus', `‚ùå Logout failed: ${error.message}`, 'error');
            }
        }

        async function testCreateQuestion() {
            if (!db || !auth.currentUser) {
                updateStatus('dbStatus', '‚ùå Please login first', 'error');
                return;
            }

            const title = document.getElementById('testQuestionTitle').value;
            const content = document.getElementById('testQuestionContent').value;
            const user = auth.currentUser;

            try {
                updateStatus('dbStatus', 'Creating question...', 'warning');
                
                const docRef = await db.collection('questions').add({
                    title: title,
                    content: content,
                    tags: ['test', 'firebase'],
                    authorId: user.uid,
                    authorName: user.email,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    votes: 0,
                    views: 0,
                    answers: 0,
                    isAnswered: false
                });
                
                updateStatus('dbStatus', `‚úÖ Question created! ID: ${docRef.id}`, 'success');
                
            } catch (error) {
                updateStatus('dbStatus', `‚ùå Failed to create question: ${error.message}`, 'error');
            }
        }

        async function testLoadQuestions() {
            if (!db) {
                updateStatus('dbStatus', '‚ùå Firebase not initialized', 'error');
                return;
            }

            try {
                updateStatus('dbStatus', 'Loading questions...', 'warning');
                
                const querySnapshot = await db.collection('questions')
                    .orderBy('createdAt', 'desc')
                    .limit(5)
                    .get();
                
                const questions = [];
                querySnapshot.forEach((doc) => {
                    questions.push({ id: doc.id, ...doc.data() });
                });
                
                updateStatus('dbStatus', `‚úÖ Loaded ${questions.length} questions successfully!`, 'success');
                console.log('Questions:', questions);
                
            } catch (error) {
                updateStatus('dbStatus', `‚ùå Failed to load questions: ${error.message}`, 'error');
            }
        }

        function checkConfiguration() {
            updateStatus('configStatus', 'Checking...', 'warning');
            
            const checks = [];
            
            // Check Firebase CDN
            if (typeof firebase !== 'undefined') {
                checks.push('‚úÖ Firebase CDN loaded');
            } else {
                checks.push('‚ùå Firebase CDN not loaded');
            }
            
            // Check config file
            if (testFirebaseConfig.apiKey !== "your-api-key-here") {
                checks.push('‚úÖ Config appears to be updated');
            } else {
                checks.push('‚ö†Ô∏è Config needs to be updated');
            }
            
            // Check browser compatibility
            if (typeof Promise !== 'undefined') {
                checks.push('‚úÖ Browser supports modern JavaScript');
            } else {
                checks.push('‚ùå Browser too old');
            }
            
            const status = checks.join('<br>');
            document.getElementById('configStatus').innerHTML = status;
        }

        // Auto-run configuration check
        setTimeout(checkConfiguration, 1000);
    </script>
</body>
</html>
